<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test</title>
</head>

<body>
    <!-- Artist Select Box -->
    <form id="artist-form">

        <!-- Label for Text Box -->
        <label for="artist-input">Choose Your Artist</label>

        <!-- Text Input Box -->
        <input type="text" id="artist-input"><br>

        <!-- Submit Button -->
        <input id="select-artist" type="submit" value="GO!">
    </form>

    <!-- Artist Information -->
    <div id="artist-div"></div>
    <div id="cuisine-div"></div>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

    function searchBandsInTown(artist) {

        // Querying the bandsintown api for the selected artist
        var queryURL = "https://rest.bandsintown.com/artists/" + artist + "/events/" + "?app_id=test";
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function (response) {
            console.log(response)
            var venuesAvailable = response
            for (i = 0; i < venuesAvailable.length; i++) {
                var venueLat = venuesAvailable[i].venue.latitude;
                var venueLong = venuesAvailable[i].venue.longitude;
                var venueName = venuesAvailable[i].venue.city;
                var venueDisplayArea = $("<div>");
                var venueDisplay = $("<button>").html(venueName);
                venueDisplay.attr("class", "venuecityButton")
                // venueDisplay.attr("value", venueName)
                venueDisplay.attr("data-lat", venueLat)
                venueDisplay.attr("data-long", venueLong)
                venueDisplayArea.append(venueDisplay);
                $("#artist-div").append(venueDisplayArea)
            }

               


        });
    }

    $(document).on("click", ".venuecityButton", function () {
        console.log('run')
                    var x = $(this).attr("data-lat")
                    var y = $(this).attr("data-long")

                    console.log(x)
                    console.log(y)

                    $.ajax({
                        url: "https://developers.zomato.com/api/v2.1/cities?lat=" + x + "&lon=" + y + "&count=1",
                        method: "GET",
                        headers: {
                            "user-key": "488e32fe25c9ed9387b879aa94952c00"
                        }

                    }
                    ).then(function (turtles) {
                        console.log(turtles)
                        cityId = turtles.location_suggestions[0].id;
                        // cityID above variable logs the city ID of results form first ajax call
                        // below the cityID is used to retrieve cusine data
                        $.ajax({
                            url: "https://developers.zomato.com/api/v2.1/cuisines?city_id=" + cityId,
                            method: "GET",
                            headers: {
                                "user-key": "488e32fe25c9ed9387b879aa94952c00"
                            }

                        }).then(function (result) {
                            console.log(result.cuisines)
                            var cusinesAvailable = result.cuisines;
                            // console.log(cusinesAvailable)
                            for (i = 0; i < cusinesAvailable.length; i++) {
                                // console.log(cusinesAvailable[i].cuisine.cuisine_name);
                                var cuisineName = cusinesAvailable[i].cuisine.cuisine_name;
                                // console.log(x);
                                var cuisineDisplayArea = $("<div>");
                                var cuisineDisplay = $("<p>").html(cuisineName);
                                // console.log(cuisineDisplay);
                                // $("#cuisineDisplayArea").append(x);
                                cuisineDisplayArea.append(cuisineDisplay);
                                $("#cuisine-div").append(cuisineDisplayArea);



                            }

                        });
                        // 

                    });
                })
            

    // Event handler for user clicking the select-artist button
    $("#select-artist").on("click", function (event) {
        // Preventing the button from trying to submit the form
        event.preventDefault();
        // Storing the artist name
        var inputArtist = $("#artist-input").val().trim();

        // Running the searchBandsInTown function(passing in the artist as an argument)
        searchBandsInTown(inputArtist);
    });

</script>

</html>